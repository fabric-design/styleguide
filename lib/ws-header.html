<!-- inject:global -->
<!-- endinject -->
<dom-module id="ws-header">
    <template>
        <!-- inject:html -->
        <div class="refills-patterns refills-components">
  <header class="navigation" role="banner">
    <div class="navigation-wrapper">
      <content select=".logo">
        <!-- Logo -->
      </content>
      <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">MENU</a>
      <nav role="navigation">
        <ul id="js-navigation-menu" class="navigation-menu show">
          <content select=".nav-link">
            <!-- Additional Items -->
          </content>
          <li class="nav-link more dropdown">
            <a href="javascript:void(0)">
              <span id="selectedLanguageFlag" class="flag"></span>
              <span id="selectedLanguage"></span>
            </a>
            <ul class="submenu dropdown-menu" id="languages">
            </ul>
          </li>
          <li class="nav-link" id="loggedInInfo">
          </li>
        </ul>
      </nav>
    </div>
  </header>
</div>
        <!-- endinject -->
        <style>
            /* inject:styles */
            @charset "UTF-8";
/**
 * Parse a numeric value from a string
 */
/**
 * Convert a pixel value to rem
 */
/**
 * Convert a list of pixel values to rem values
 */
/**
* Z-index function for managing the values
*/
:host ::content .flag {
  display: inline-block;
  width: 16px;
  height: 11px;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAWCAYAAAChWZ5EAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADuUlEQVRIibWVXWjWdRTHP/9nz6KYVG5Ggk4x3NLCUS41bEtZvlCkqwulUClNHNJFgUTtIswmUQoaEolgoxvR0JQIJS8ctCE6kprLlyYbilFT2sqs+f+9ntPF88wRCF38nw4czuH3wvmcL/zOL1FVstiyZYuUmIIIlOVxQXA+oOIB+c/7+UzVAe9TNm16GwARQUSIMRDjaAyEUHTvCTEQgsd7z+HDB7MD5HI5AE539xYKhID3Hucczjqss1g75sYYrDE0v9AElECBauB+EaqLxYNzBO/x1uKtxTmHNwZnDdZafGqwzjIx+NIAvOQt9TFS7z3qHDoarUWtRYxFrCnmBk0t4gzlPpAvBYB6h8YIzqHOo9agziG3AYrFrUXS9DaUeoeWBAAghn937RxqDGLMGEiaos4SjS2cjZ5YCgA/H6hVtEzQKIgXxMfbuQYtRohe0QDiFX0iwXSVQoE60MmCjo+IFFwlIjGgIoiEwvOMEYlaXAOtSpDFJQDAgQYP5bPJ4UgkouJIJIB6VCIqHpWAakQ1oBrABXIjkGSdhEd2PqZ3RxAHWgY2Lcw/vRdyBiSCK4PoCnl5DsQAZXDTQbJrT4fWNtTR1XmJ60MAkSiRd1bP4twHn6AxMuvdN3hzRzfqc4zcMlTX3ENTzzEuP7+SrevmJ1kayFfeN46l/R0saVnBwM8jnPphkKgJNdMqqX28ApxFp1Xy7NxqfIg0PFrFnM49cGgbu45ezKQeQK6jP+XExEUk+w8w/Uo3a5qnMzhoSRLg7AD09pMkcHVYaSnvp67rAMlbbXz+ZR8fvX86OwDAL4N/sHmojqvxIWLbe7RufKSwm/4FaQrA9su7qVjSQN+L62h67gDnfrqJsTYzAH0Dwyqid7YVK1SXL7/jlojqmQvXVVXJ4vkft35M7ewKONsP3oNzY1EEtZawcGFhvHqPOAcxkp8xieNn/qb+ysn/UYHGRg1znxztWVVVY4waYlAfgnafv5ZZgdyGLSfZ0d7DqpbjnL9wA34fxq1/FQAdKXweBVN+faaJzr3fMHlKOy+v/5p5T7dl6x7IGRN4sOou9u1ZytRDO/nzs3ZeG98CUPhInANVnlq4nwknOpiTXKNncSd1c6aChOwAq9fUsKp5BubDVnoXrGHLrXlUjouoQjJzEsnMiagq1Q9XsvqVQ3TNbOSBvXvZ+N1mXl/bmBkgP/jbMJ8u2cCRmgV8v+9bfEgJMbJ2ZQ3HTt1AQ2DpxSG++OoESOTg0U4mTBlP6/ZtXGrdDazKBPAP38BUStCEE90AAAAASUVORK5CYII=");
  background-position: 0 0;
  background-repeat: no-repeat; }
  :host ::content .flag.flag-de {
    background-position: -16px 0; }
  :host ::content .flag.flag-en {
    background-position: 0 -11px; }

header.navigation {
  background-color: #272829;
  border-bottom: 1px solid #0e0f0f;
  min-height: 60px;
  width: 100%;
  z-index: 999; }
  header.navigation .navigation-wrapper {
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
    position: relative;
    z-index: 9999; }
    header.navigation .navigation-wrapper::after {
      clear: both;
      content: "";
      display: block; }
    header.navigation .navigation-wrapper::after {
      clear: both;
      content: "";
      display: block; }
  header.navigation .logo {
    float: left;
    max-height: 60px;
    padding-left: 1em;
    padding-right: 2em; }
    header.navigation .logo img {
      max-height: 60px;
      padding: 0.8em 0; }
  header.navigation .navigation-menu-button {
    color: rgba(255, 255, 255, 0.7);
    display: block;
    float: right;
    line-height: 60px;
    margin: 0;
    padding-right: 1em;
    text-decoration: none;
    text-transform: uppercase; }
    @media screen and (min-width: 53.75em) {
      header.navigation .navigation-menu-button {
        display: none; } }
    header.navigation .navigation-menu-button:focus, header.navigation .navigation-menu-button:hover {
      color: white; }
  header.navigation nav {
    float: none;
    min-height: 60px;
    z-index: 9999999; }
    @media screen and (min-width: 53.75em) {
      header.navigation nav {
        float: left; } }
  header.navigation ul.navigation-menu {
    clear: both;
    display: none;
    margin: 0 auto;
    overflow: visible;
    padding: 0;
    width: 100%;
    z-index: 9999; }
    header.navigation ul.navigation-menu.show {
      display: block; }
    @media screen and (min-width: 53.75em) {
      header.navigation ul.navigation-menu {
        display: inline;
        margin: 0;
        padding: 0; } }
  header.navigation ul li.nav-link {
    background: #272829;
    display: block;
    line-height: 60px;
    overflow: hidden;
    padding-right: 0.8em;
    text-align: right;
    width: 100%;
    z-index: 9999;
    cursor: pointer;
    color: rgba(255, 255, 255, 0.7); }
    header.navigation ul li.nav-link:hover {
      color: white; }
    @media screen and (min-width: 53.75em) {
      header.navigation ul li.nav-link {
        background: transparent;
        display: inline;
        line-height: 60px;
        text-decoration: none;
        width: auto; } }
    header.navigation ul li.nav-link a {
      color: rgba(255, 255, 255, 0.7);
      display: inline-block;
      text-decoration: none;
      box-sizing: content-box; }
      @media screen and (min-width: 53.75em) {
        header.navigation ul li.nav-link a {
          padding-right: 1em; } }
      header.navigation ul li.nav-link a:focus, header.navigation ul li.nav-link a:hover {
        color: white; }
      header.navigation ul li.nav-link a:after {
        position: relative !important; }
  header.navigation .active-nav-item a {
    border-bottom: 1px solid rgba(255, 255, 255, 0.5);
    padding-bottom: 3px; }
  header.navigation li.more.nav-link {
    padding-right: 0; }
    @media screen and (min-width: 53.75em) {
      header.navigation li.more.nav-link {
        padding-right: 1em; } }
    header.navigation li.more.nav-link > ul > li:first-child a {
      padding-top: 1em; }
    header.navigation li.more.nav-link a {
      margin-right: 1em; }
    header.navigation li.more.nav-link > a {
      padding-right: 0.6em; }
    header.navigation li.more.nav-link > a:after {
      position: absolute;
      top: auto;
      right: -0.4em;
      bottom: auto;
      left: auto;
      content: '\25BE';
      color: rgba(255, 255, 255, 0.7); }
  header.navigation li.more {
    overflow: visible;
    padding-right: 0; }
    header.navigation li.more a {
      padding-right: 0.8em; }
    header.navigation li.more > a {
      padding-right: 1.6em;
      position: relative; }
      @media screen and (min-width: 53.75em) {
        header.navigation li.more > a {
          margin-right: 1em; } }
      header.navigation li.more > a:after {
        content: 'â€º';
        font-size: 1.2em;
        position: absolute;
        right: 0.5em; }
    header.navigation li.more:focus > .submenu,
    header.navigation li.more:hover > .submenu {
      display: block; }
    @media screen and (min-width: 53.75em) {
      header.navigation li.more {
        padding-right: 0.8em;
        position: relative; } }
  header.navigation .dropdown-menu .flag {
    margin-top: 25px; }
  header.navigation ul.submenu {
    display: none;
    padding-left: 0; }
    @media screen and (min-width: 53.75em) {
      header.navigation ul.submenu {
        left: -1em;
        position: absolute;
        top: 1.5em; } }
    @media screen and (min-width: 53.75em) {
      header.navigation ul.submenu .submenu {
        left: 11.8em;
        top: 0; } }
    header.navigation ul.submenu li {
      display: block;
      padding-right: 0; }
      @media screen and (min-width: 53.75em) {
        header.navigation ul.submenu li {
          line-height: 46.15385px; }
          header.navigation ul.submenu li:first-child > a {
            border-top-left-radius: 3px;
            border-top-right-radius: 3px; }
          header.navigation ul.submenu li:last-child > a {
            border-bottom-left-radius: 3px;
            border-bottom-right-radius: 3px;
            padding-bottom: 0.7em; } }
      header.navigation ul.submenu li a {
        background-color: #202021;
        display: inline-block;
        text-align: right;
        width: 100%;
        padding-top: 0em !important; }
        @media screen and (min-width: 53.75em) {
          header.navigation ul.submenu li a {
            background-color: #272829;
            padding-left: 1em;
            text-align: left;
            width: 12em; } }
  header.navigation .navigation-tools {
    background: #505050;
    clear: both;
    display: block;
    height: 60px; }
    @media screen and (min-width: 53.75em) {
      header.navigation .navigation-tools {
        background: transparent;
        clear: none;
        float: right; } }
  header.navigation #loggedInInfo a {
    margin-right: 1em; }
  header.navigation #loggedInInfo #logOutButton {
    margin-left: 0.5em;
    width: 1em;
    height: 1em;
    vertical-align: middle;
    zoom: 1.5; }
    header.navigation #loggedInInfo #logOutButton #logOutIcon {
      height: 100%;
      background-color: white;
      -webkit-mask-image: url('data:image/svg+xml;utf-8,<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M48.501,27.015c0,0.827,0.671,1.5,1.5,1.5h21.486v42.974H50.001c-0.829,0-1.5,0.672-1.5,1.5c0,0.829,0.671,1.5,1.5,1.5  h22.986c0.828,0,1.5-0.671,1.5-1.5V27.013c0-0.828-0.672-1.5-1.5-1.5H50.001C49.172,25.515,48.501,26.187,48.501,27.015z   M48.473,38.447c0,0.384,0.146,0.768,0.438,1.061l8.964,8.963h-30.86c-0.828,0-1.5,0.671-1.5,1.5c0,0.829,0.672,1.5,1.5,1.5h30.86  l-8.993,8.992c-0.293,0.293-0.439,0.677-0.439,1.062c0,0.383,0.146,0.768,0.439,1.061c0.585,0.586,1.536,0.586,2.121,0  l11.553-11.553c0.141-0.141,0.25-0.308,0.327-0.492c0.003-0.008,0.004-0.016,0.007-0.022c0.067-0.169,0.105-0.354,0.105-0.547  s-0.039-0.378-0.105-0.548c-0.003-0.007-0.004-0.015-0.007-0.021c-0.077-0.187-0.188-0.354-0.328-0.493L51.032,37.386  c-0.585-0.586-1.535-0.586-2.121,0C48.618,37.679,48.473,38.063,48.473,38.447z"></path></svg>');
      mask-image: url('data:image/svg+xml;utf-8,<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M48.501,27.015c0,0.827,0.671,1.5,1.5,1.5h21.486v42.974H50.001c-0.829,0-1.5,0.672-1.5,1.5c0,0.829,0.671,1.5,1.5,1.5  h22.986c0.828,0,1.5-0.671,1.5-1.5V27.013c0-0.828-0.672-1.5-1.5-1.5H50.001C49.172,25.515,48.501,26.187,48.501,27.015z   M48.473,38.447c0,0.384,0.146,0.768,0.438,1.061l8.964,8.963h-30.86c-0.828,0-1.5,0.671-1.5,1.5c0,0.829,0.672,1.5,1.5,1.5h30.86  l-8.993,8.992c-0.293,0.293-0.439,0.677-0.439,1.062c0,0.383,0.146,0.768,0.439,1.061c0.585,0.586,1.536,0.586,2.121,0  l11.553-11.553c0.141-0.141,0.25-0.308,0.327-0.492c0.003-0.008,0.004-0.016,0.007-0.022c0.067-0.169,0.105-0.354,0.105-0.547  s-0.039-0.378-0.105-0.548c-0.003-0.007-0.004-0.015-0.007-0.021c-0.077-0.187-0.188-0.354-0.328-0.493L51.032,37.386  c-0.585-0.586-1.535-0.586-2.121,0C48.618,37.679,48.473,38.063,48.473,38.447z"></path></svg>'); }

::content .logo {
  float: left;
  max-height: 60px;
  margin-left: 1em;
  margin-right: 2em;
  line-height: 60px;
  padding-top: 0;
  background-color: transparent;
  color: #00abf2;
  text-decoration: none;
  transition: color .1s linear; }
  ::content .logo img {
    box-sizing: content-box;
    padding: 1.2em 0;
    height: 20px; }
  ::content .logo > span {
    display: block;
    float: right;
    margin-left: 10px; }
  ::content .logo img {
    padding: 1.2em 0; }

::content li.nav-link {
  background: transparent;
  display: inline;
  line-height: 60px;
  text-decoration: none;
  width: auto; }
  ::content li.nav-link a {
    padding-right: 1em;
    color: rgba(255, 255, 255, 0.7);
    display: inline-block;
    text-decoration: none; }

            /* endinject */
        </style>
    </template>

    <script>
    (function(){
        /* inject:js */
        'use strict';

//Get the contents of the template (_currentScript is available with webcomponents.js, use currentScript if you don't use this Polyfill)
var template = (document._currentScript || document.currentScript).ownerDocument.querySelector('template');
var availableLanguages = ['de', 'en'];
var state = {
    tokenName: "zalando-internal-access_token",
    stateName: "zalando-internal-access_state",
    languageName: 'language',
    cookiePath: '/',
    cookieDomain: '.zalan.do',
    lang: null,
    loggedIn: null,
    clientId: null,
    redirectUrl: null,
    userServiceUrl: null,
    tokenInfoUrl: null
};
// Remember url at loadtime to not have sideeffects by ie Angular2
var urlAtStart = window.location.href;

Polymer({
    // Use createdCallback instead of constructor to init an element.
    ready: function ready() {
        var _this = this;

        this.state = state;
        this.getAttributes();

        this.setupLanguages();
        // would fire initial before
        var lang = this.getLanguage();
        this.setLanguage(lang);

        this.checkIsLoggedIn().then(function () {
            return _this.getUser();
        }).then(function () {
            return _this.showUser();
        }).catch(function (err) {
            var message = "Getting Token-/User-Info failed!";
            if (err) {
                message += " " + err.toString();
            }
            _this.propagateError(message);
        });
    },
    propagateError: function propagateError(reason) {
        var event = new CustomEvent("error", {
            detail: {
                message: reason
            }
        });
        this.dispatchEvent(event);
    },
    getAttributes: function getAttributes() {
        this.state = Object.assign({}, this.state, {
            clientId: this.getAttribute('client-id'),
            redirectUrl: this.getAttribute('redirect-url'),
            userServiceUrl: this.getAttribute('userservice-url'),
            tokenInfoUrl: this.getAttribute('tokeninfo-url')
        });
    },
    setupLanguages: function setupLanguages() {
        var _this2 = this;

        var languagesElem = this.$$('#languages');

        availableLanguages.map(function (lang) {
            var dummy = document.createElement('div');
            dummy.innerHTML = '<li>\n                <a><span class="flag flag-' + lang + '"></span> <span translate="global.language.{{lang}}">' + lang + '</span></a>\n            </li>';
            var node = dummy.childNodes[0];
            node.addEventListener("click", function () {
                return _this2.setLanguage(lang);
            });
            languagesElem.appendChild(node);
        });
    },
    getLanguage: function getLanguage() {
        return this.state.lang || window.localStorage.getItem(this.state.languageName) || availableLanguages[0];
    },
    setLanguage: function setLanguage(lang) {
        if (this.state.lang != lang) {
            this.state.lang = lang;
            window.localStorage.setItem(this.state.languageName, lang);
            this.showLanguage(lang);
            this.propagateLanguageChange(lang);
        }
    },
    showLanguage: function showLanguage(lang) {
        this.$$('#selectedLanguageFlag').className = "flag flag-" + lang;
        this.$$('#selectedLanguage').innerText = lang;
    },
    propagateLanguageChange: function propagateLanguageChange(lang) {
        var event = new CustomEvent("language-changed", {
            detail: {
                language: lang
            }
        });
        this.dispatchEvent(event);
    },
    login: function login() {
        var url = "https://auth.zalando.com/z/oauth2/authorize?realm=/employees&response_type=token&scope=uid" + "&client_id=" + this.state.clientId + "&redirect_uri=" + this.state.redirectUrl + "&state=" + this.setSessionState();

        window.location.href = url;
    },
    logout: function logout() {
        this.removeCookie();

        this.showLoggedOut();
        this.propagateLoginStatusChange(false);
    },
    checkIsLoggedIn: function checkIsLoggedIn() {
        var _this3 = this;

        return new Promise(function (resolve, reject) {
            _this3.getToken(urlAtStart).then(function (token) {
                // checking that token is still valid
                _this3.getTokenInfo().then(function () {
                    _this3.showLoggedIn();

                    _this3.propagateLoginStatusChange(true, token);
                    resolve();
                }, function (err) {
                    _this3.logout();
                    reject(err);
                });
            }, function (err) {
                _this3.logout();
                reject(err);
            });
        });
    },
    propagateLoginStatusChange: function propagateLoginStatusChange(isLoggedIn, token) {
        if (this.state.loggedIn !== isLoggedIn) {
            this.state.loggedIn = isLoggedIn;

            var event = new CustomEvent("login-status-changed", {
                detail: {
                    loggedIn: isLoggedIn,
                    token: token || null
                }
            });
            this.dispatchEvent(event);
        }
    },
    showLoggedOut: function showLoggedOut() {
        var loggedInInfo = this.$$('#loggedInInfo');
        loggedInInfo.innerHTML = '<a class="auto-size"><span translate="global.menu.signein">Login</span></i></a>';
        loggedInInfo.removeEventListener("click", this.logout);
        loggedInInfo.addEventListener("click", this.login.bind(this));
    },
    showLoggedIn: function showLoggedIn() {
        var loggedInInfo = this.$$('#loggedInInfo');
        loggedInInfo.innerHTML = '<span translate="global.menu.signedinas"></span>\n\t\t\t<span id="userName">Loading...</span>\n\t\t\t<a class="auto-size" id="logOutButton" type="button"><div id="logOutIcon"></div></a>';
        loggedInInfo.removeEventListener("click", this.login);
        loggedInInfo.addEventListener("click", this.logout.bind(this));
    },
    setSessionState: function setSessionState() {
        // create new state guid
        var state = this.guid();

        // save the state to check for it on return
        window.localStorage.setItem(this.state.stateName, state);
        return state;
    },
    checkSessionState: function checkSessionState(state) {
        var valid = window.localStorage.getItem(this.state.stateName) === state;
        window.localStorage.removeItem(this.state.stateName);
        return valid;
    },
    getToken: function getToken(url) {
        var _this4 = this;

        if (!url) {
            url = window.location.href;
        }
        return new Promise(function (resolve, reject) {
            var token = _this4.getTokenFromUrl(url);
            if (token) {
                var sessionState = _this4.getStateFromUrl(url);
                if (_this4.checkSessionState(sessionState)) {
                    _this4.setCookie(token);
                    return resolve(token);
                }
            }
            token = _this4.getCookieValue(_this4.state.tokenName);
            if (token) {
                return resolve(token);
            }

            reject();
        });
    },
    getTokenFromUrl: function getTokenFromUrl(url) {
        var urlQueryTokenPart = /access_token=([^&]+)/.exec(url);
        return urlQueryTokenPart != null ? urlQueryTokenPart[1] : null;
    },
    getStateFromUrl: function getStateFromUrl(url) {
        var urlQueryStatePart = /state=([^&]+)/.exec(url);
        return urlQueryStatePart[1];
    },
    getTokenInfo: function getTokenInfo() {
        var _this5 = this;

        return new Promise(function (resolve, reject) {
            _this5.request('GET', _this5.state.tokenInfoUrl).then(function (data) {
                _this5.state = Object.assign({}, _this5.state, {
                    userUID: data.uid
                });
                resolve(data.uid);
            }, function (err) {
                _this5.logout();
                reject(err);
            });
        });
    },
    getUser: function getUser() {
        var _this6 = this;

        return new Promise(function (resolve, reject) {
            _this6.request('GET', _this6.state.userServiceUrl + '?q=' + _this6.state.userUID).then(function (data) {
                var user = data[0];
                if (!user) {
                    reject();
                }
                var userInfo = {
                    userName: user.name,
                    userEmail: user.email
                };
                _this6.state = Object.assign({}, _this6.state, userInfo);
                resolve(userInfo);
            }, function (err) {
                _this6.logout();
                reject(err);
            });
        });
    },
    showUser: function showUser() {
        this.$$('#userName').innerText = this.state.userName;
    },
    setCookie: function setCookie(token) {
        // setting domain does not work for dev localhost environment
        //document.cookie = `${this.state.tokenName}=${token},path=${this.state.cookiePath};domain=${this.state.cookieDomain};`
        document.cookie = this.state.tokenName + '=' + token + ';path=' + this.state.cookiePath + ';';
    },
    removeCookie: function removeCookie() {
        document.cookie = this.state.tokenName + '=;path=' + this.state.cookiePath + ';domain=' + this.state.cookieDomain + ';expires=Thu, 01 Jan 1970 00:00:01 GMT";';
    },


    // HELPERS

    // matches a cookie name in the cookie string and returns the last value
    getCookieValue: function getCookieValue(a) {
        var b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    },
    guid: function guid() {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        }

        return '' + s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
    },


    // Method: 'GET', 'POST'
    request: function request(method, url) {
        var _this7 = this;

        var headers = new Headers();
        return this.getToken(urlAtStart).then(function (token) {
            headers.append("Authorization", 'Bearer ' + token);
            return Promise.resolve();
        }).then(function () {
            return fetch(url, {
                method: method,
                headers: headers,
                mode: 'cors',
                cache: 'default'
            }).then(_this7.checkStatus).then(function (response) {
                return response.json();
            });
        });
    },
    checkStatus: function checkStatus(response) {
        if (response.status >= 200 && response.status < 300) {
            return response;
        } else {
            var error = new Error(response.statusText);
            error.response = response;
            throw error;
        }
    },
    attributeChanged: function attributeChanged(attrName) {
        switch (attrName) {
            case "redirect-url":
            case "client-id":
            case "userservice-url":
                this.getAttributes();
                break;
        }
    }
});
        /* endinject */
    })()
    </script>
</dom-module>
